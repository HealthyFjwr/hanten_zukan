<% if flash[:alert].present? %>
  <p style="margin-top:12px; color:#b91c1c;"><%= flash[:alert] %></p>
<% end %>

<h1 style="margin:0 0 12px;">飲食店追加 </h1>

<form method="get" action="<%= search_admin_search_restaurants_path %>">
  <input type="text" name="prefecture" placeholder="都道府県"
         style="padding:8px; width:160px; border:1px solid #d1d5db; border-radius:8px;">
  <input type="text" name="city" placeholder="市町村"
         style="padding:8px; width:160px; border:1px solid #d1d5db; border-radius:8px;">
  <input type="text" name="keyword" placeholder="店名"
         style="padding:8px; width:320px; border:1px solid #d1d5db; border-radius:8px;">
  <button type="submit"
          style="padding:8px 12px; border-radius:8px; border:none; cursor:pointer;">
    検索
  </button>
</form>

<% if @query.present? %>
  <p style="margin-top:12px;">
    検索ワード: <strong><%= @query %></strong>
  </p>

  <% if @candidates.present? %>
    <form method="get" action="<%= details_admin_search_restaurants_path %>" style="margin-top:12px;">
      <!-- 次のリクエストでも検索条件を維持（hidden） -->
      <input type="hidden" name="prefecture" value="<%= params[:prefecture] %>">
      <input type="hidden" name="city" value="<%= params[:city] %>">
      <input type="hidden" name="keyword" value="<%= params[:keyword] %>">

      <div style="display:flex; flex-direction:column; gap:8px;">
        <% selected_ids = Array(params[:place_ids]).map(&:to_s) %>

        <% @candidates.each do |c| %>
          <label style="display:flex; gap:10px; align-items:flex-start; padding:10px;
                        border:1px solid #e5e7eb; border-radius:10px; cursor:pointer;">
            <input type="checkbox"
                   name="place_ids[]"
                   value="<%= c[:place_id] %>"
                   <%= 'checked' if selected_ids.include?(c[:place_id].to_s) %>
                   style="margin-top:4px;">
            <div>
              <div style="font-weight:600;"><%= c[:name] %></div>
              <div style="color:#6b7280;"><%= c[:address] %></div>
            </div>
          </label>
        <% end %>
      </div>

      <button type="submit"
              style="margin-top:12px; padding:8px 12px; border-radius:8px; border:none; cursor:pointer;">
        選択を確定
      </button>
    </form>

    <% if params[:place_ids].present? %>
      <p style="margin-top:12px;">
        選択件数: <strong><%= Array(params[:place_ids]).size %></strong>
      </p>
    <% end %>
  <% else %>
    <p style="margin-top:12px; color:#6b7280;">該当なし</p>
  <% end %>
<% end %>
